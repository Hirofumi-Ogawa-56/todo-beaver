<!-- app/views/teams/index.html.erb -->
<% content_for :sidebar do %>
  <%= render "teams/sidebar" %>
<% end %>

<h1 class="text-xl font-bold mb-4"><%= t('teams.index.title') %></h1>

<div class="mb-4">
  <%= link_to t('teams.index.new_team'),
              new_team_path,
              class: "text-sm px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700" %>
</div>

<% if @teams.any? %>
  <table class="w-full text-sm">
    <thead class="sticky top-0 bg-gray-50 z-10">
      <tr class="border-b">
        <th class="text-left py-2 px-2"><%= t('activerecord.attributes.team.name') %></th>
        <th class="text-left py-2 px-2">チームID</th>
        <th class="text-left py-2 px-2">役割</th>
        <th class="text-left py-2 px-2"><%= t('common.created_at') %></th>
        <th class="text-left py-2 px-2"></th>
      </tr>
    </thead>

    <tbody>
      <% @teams.each do |team| %>
        <tr class="border-b border-gray-50">
          <td class="py-2">
            <%= link_to team_path(team), class: "inline-block" do %>
              <%= team_chip(
                    team,
                    size: :xs,
                    wrapper_class: "px-2 py-1 rounded bg-gray-100 text-xs"
                  ) %>
            <% end %>
          </td>
          
          <%# チームID（トークン）を表示 %>
          <td class="py-2 px-2">
            <span class="font-mono text-xs bg-gray-50 px-2 py-1 border rounded text-gray-700 select-all">
              <%= team.join_token %>
            </span>
          </td>

          <td class="py-2 px-2">
            <% if team.admin?(current_profile) %>
              <span class="px-2 py-0.5 bg-blue-100 text-blue-700 text-[10px] rounded-full font-bold">
                <%= t('common.admin', default: '管理者') %>
              </span>
            <% else %>
              <span class="px-2 py-0.5 bg-gray-100 text-gray-600 text-[10px] rounded-full">
                <%= t('common.member', default: 'メンバー') %>
              </span>
            <% end %>
          </td>

          <td class="py-2 px-2 text-gray-500 text-xs">
            <%= l(team.created_at.to_date) %>
          </td>

          <td class="py-2 text-right">
            <div class="flex items-center justify-end gap-3">
              <%= link_to t('teams.members.title', default: "メンバー"), 
                manage_team_path(team), 
                class: "text-xs text-gray-600 underline hover:text-blue-600" %>

              <%= link_to t('common.edit'), 
                          edit_team_path(team), 
                          class: "text-xs text-gray-600 underline hover:text-blue-600" %>

              <%= button_to t('common.delete'),
                            team_path(team),
                            method: :delete,
                            form: { 
                              data: { turbo_confirm: t('common.confirm_delete') },
                              class: "inline" 
                            },
                            class: "text-xs text-red-600 underline bg-transparent border-0 p-0 cursor-pointer hover:text-red-800" %>
            </div>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <div class="py-10 text-center border-2 border-dashed border-gray-100 rounded-lg">
    <p class="text-sm text-gray-500">
      <%= t('teams.index.not_joined_team') %>
    </p>
  </div>
<% end %>