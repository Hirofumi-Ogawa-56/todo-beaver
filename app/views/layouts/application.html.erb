<!-- app/views/layouts/application.html.erb -->
<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "Todo Beaver" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <link rel="manifest" href="/manifest.json">
    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">
    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body class="bg-white">
    <!-- ヘッダー -->
      <header class="fixed top-0 inset-x-0 bg-gray-50 border-b shadow-sm z-10">
        <div class="w-full px-4 py-2">
          <!-- 1段：左 = プロフィール + ナビ / 右 = ロゴ -->
          <div class="flex items-center justify-between">
            <!-- 左側：プロフィールブロック + ナビブロック -->
            <div class="flex items-center gap-8">
              <!-- プロフィール表示 + プロフィール切替 + ドロップダウン -->
              <div class="flex items-center gap-4">
                <% if user_signed_in? && current_user.profiles.any? && current_profile %>
                  <!-- プロフィールアイコン＋名前（クリックでメニュー） -->
                  <details class="relative">
                    <summary class="list-none cursor-pointer">
                      <%= profile_chip(
                            current_profile,
                            size: :sm,
                            wrapper_class: "text-sm text-gray-700 font-semibold"
                          ) %>
                    </summary>

                    <!-- ドロップダウンメニュー -->
                    <div class="absolute mt-2 left-0 w-40 bg-white border border-gray-200 rounded shadow text-sm z-50">
                      <%= link_to "ログアウト",
                                  destroy_user_session_path,
                                  data: { turbo_method: :delete },
                                  class: "block w-full text-left px-3 py-2 hover:bg-gray-100" %>
                    </div>
                  </details>

                  <!-- プロフィール切り替えセレクト -->
                  <div>
                    <%= form_with url: switch_profiles_path, method: :post, local: true do |f| %>
                      <%= f.select :profile_id,
                                  options_from_collection_for_select(
                                    current_user.profiles,
                                    :id,
                                    :label,
                                    current_profile&.id
                                  ),
                                  {},
                                  class: "border border-gray-200 rounded px-3 py-1 text-sm bg-white",
                                  onchange: "this.form.submit();" %>
                    <% end %>
                  </div>
                <% end %>
              </div>

              <!-- プロフィールの右に少し空けて、左詰めでナビ -->
              <% if user_signed_in? %>
                <nav class="flex items-center gap-3">
                  <!-- タスク -->
                  <%= link_to root_path,
                              class: "text-lg text-gray-700 font-semibold px-3 py-1 rounded hover:bg-gray-100 flex items-center gap-1" do %>
                    <%= image_tag "beaver_icon.png",
                                  alt: "タスク",
                                  class: "block",
                                  style: "height: 25px; width: auto;" %>
                    <span>-Task</span>
                  <% end %>

                  <!-- ワークス -->
                  <%= link_to root_path,
                              class: "text-lg text-gray-700 font-semibold px-3 py-1 rounded hover:bg-gray-100 flex items-center gap-1" do %>
                    <%= image_tag "owl_icon.png",
                                  alt: "タスク",
                                  class: "block",
                                  style: "height: 25px; width: auto;" %>
                    <span>-Works</span>
                  <% end %>

                  <!-- チャット -->
                  <%= link_to root_path,
                              class: "text-lg text-gray-700 font-semibold px-3 py-1 rounded hover:bg-gray-100 flex items-center gap-1" do %>
                    <%= image_tag "orca_icon.png",
                                  alt: "タスク",
                                  class: "block",
                                  style: "height: 20px; width: auto;" %>
                    <span>-Chat</span>
                  <% end %>

                  <!-- ソーシャル -->
                  <%= link_to root_path,
                              class: "text-lg text-gray-700 font-semibold px-3 py-1 rounded hover:bg-gray-100 flex items-center gap-1" do %>
                    <%= image_tag "rabbit_icon.png",
                                  alt: "タスク",
                                  class: "block",
                                  style: "height: 25px; width: auto;" %>
                    <span>-Social</span>
                  <% end %>                  
                  
                  <!-- プロフィール -->
                  <%= link_to home_profile_settings_path,
                              class: "text-lg text-gray-700 font-semibold px-3 py-1 rounded hover:bg-gray-100 flex items-center gap-1" do %>
                    <%= image_tag "butterfly_icon.png",
                                  alt: "プロフィール",
                                  class: "block",
                                  style: "height: 25px; width: auto;" %>
                    <span>-Profile</span>
                  <% end %>

                  <!-- チーム -->
                  <%= link_to home_team_settings_path,
                              class: "text-lg text-gray-700 font-semibold px-3 py-1 rounded hover:bg-gray-100 flex items-center gap-1" do %>
                    <%= image_tag "elephant_icon.png",
                                  alt: "チーム",
                                  class: "block",
                                  style: "height: 33px; width: auto;" %>
                    <span>-Team</span>
                  <% end %>
                </nav>
              <% end %>
            </div>

            <!-- 右側：ロゴ（イラスト） -->
            <div class="flex items-center">
              <%= link_to root_path, class: "flex items-center gap-2" do %>
                <%= image_tag "zoo_logo.png",
                              alt: "Todo Beaver",
                              class: "block",
                              style: "height: 45px; width: auto;" %>
              <% end %>
            </div>
          </div>
        </div>
      </header>

    <!-- メインコンテンツ -->
    <main class="pt-20 pb-0">
      <% if notice %>
        <div class="mb-4 bg-green-100 text-green-800 px-4 py-2 rounded">
          <%= notice %>
        </div>
      <% end %>
      <% if alert %>
        <div class="mb-4 bg-red-100 text-red-800 px-4 py-2 rounded">
          <%= alert %>
        </div>
      <% end %>

      <div
        class="flex gap-0 min-h-[calc(100vh-5rem)]"
        data-controller="side-panel"
        data-side-panel-initial-width-value="480"
      >
        <% if content_for?(:sidebar) %>
          <aside class="w-60 shrink-0 border-r border-gray-200 px-4 pt-6 pb-6 bg-transparent">
            <%= yield :sidebar %>
          </aside>

          <section class="flex-1 bg-white px-6 pt-6 pb-6 overflow-auto">
            <%= yield %>
          </section>
        <% else %>
          <section class="flex-1 bg-white px-6 pt-6 pb-6">
            <%= yield %>
          </section>
        <% end %>

      <!-- 共通サイドパネルを描画 -->
      <%= render "shared/side_panel" %>
      </div>
    </main>

    <!-- Tailwind に yellow系クラスを認識させるためのダミー要素（画面には表示されません） -->
    <span class="hidden bg-yellow-100 bg-yellow-200 text-yellow-800 border-yellow-300"></span>

  </body>
</html>

