<!-- app/views/tasks/_form.html.erb -->
<%= form_with model: @task, local: true do |f| %>
  <% if @task.errors.any? %>
    <div class="mb-4 p-3 bg-red-50 text-red-700 rounded text-sm">
      <p class="font-semibold"><%= @task.errors.count %>件のエラーがあります。</p>
      <ul class="list-disc list-inside">
        <% @task.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <!-- タイトル -->
  <div class="mb-4">
    <%= f.label :title, "タイトル", class: "block text-sm mb-1" %>
    <%= f.text_field :title,
                     class: "border rounded px-2 py-1 w-full text-sm",
                     placeholder: "タスクの内容を一言で" %>
  </div>

  <!-- 期限 -->
  <div class="mb-4">
    <%= f.label :due_date, "期限", class: "block text-sm mb-1" %>

    <div class="flex items-center gap-2">
      <!-- 日付：カレンダーで選ぶ -->
      <%= f.date_field :due_date,
                       value: (@task.due_date || @task.due_at&.to_date),
                       class: "border rounded px-2 py-1 text-sm" %>

      <span class="text-sm text-gray-500">時間</span>

      <!-- 時刻：テキスト入力のみ（30分単位を想定） -->
      <%= f.text_field :due_time,
                       value: (@task.due_time || @task.due_at&.strftime("%H:%M")),
                       class: "border rounded px-2 py-1 text-sm w-20",
                       placeholder: "23:30",
                       inputmode: "numeric",
                       pattern: "[0-2][0-9]:(00|30)" %>
    </div>

    <p class="text-[11px] text-gray-500 mt-1">
      例）09:00, 13:30 のように 30分単位で入力してください。空の場合は期限なしになります。
    </p>
  </div>

  <!-- タグ（カンマ区切り） -->
  <div class="mb-4">
    <%= f.label :tag_list, "タグ（カンマ区切り）", class: "block text-sm mb-1" %>
    <%= f.text_field :tag_list,
                     value: @task.tag_list,
                     class: "border rounded px-2 py-1 w-full text-sm",
                     placeholder: "例）RUNTEQ, Rails, バグ修正" %>
    <p class="text-[11px] text-gray-500 mt-1">
      カンマ（,）区切りで複数タグを入力できます。
    </p>
  </div>

  <!-- 担当者（複数選択） -->
  <div class="mb-4">
    <%= f.label :assignee_ids, "担当者（複数選択可）", class: "block text-sm mb-1" %>
    <%= f.collection_select :assignee_ids,
                            @assignee_candidates,
                            :id,
                            :display_name,
                            {},
                            multiple: true,
                            size: [@assignee_candidates.size, 8].min,
                            class: "border rounded px-2 py-1 w-full text-sm" %>
    <p class="text-[11px] text-gray-500 mt-1">
      Ctrl（Windows）または Command（Mac）を押しながらクリックすると複数選択できます。
    </p>
  </div>

  <!-- 詳細 -->
  <div class="mb-4">
    <%= f.label :description, "詳細", class: "block text-sm mb-1" %>
    <%= f.text_area :description,
                    rows: 4,
                    class: "border rounded px-2 py-1 w-full text-sm" %>
  </div>

  <!-- ステータス -->
  <div class="mb-4">
    <%= f.label :status, "ステータス", class: "block text-sm mb-1" %>
    <%= f.select :status,
                 Task.statuses.keys.map { |k| [k, k] },
                 {},
                 class: "border rounded px-2 py-1 w-full text-sm" %>
  </div>

  <%= f.submit class: "px-4 py-2 bg-blue-600 text-white text-sm rounded hover:bg-blue-700" %>
<% end %>