<!-- app/views/tasks/index.html.erb -->
<% content_for :sidebar do %>
  <%= render "tasks/sidebar" %>
<% end %>

<h1 class="text-xl font-bold mb-4">タスク一覧</h1>

<div class="mb-4 flex justify-between items-center text-sm">
  <div class="text-gray-600">
    現在のプロフィール：
    <span class="font-semibold"><%= current_profile&.label || "未選択" %></span>
  </div>

  <%= link_to "新規タスク作成",
              new_task_path,
              class: "px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-xs" %>
</div>

<% if @tasks.any? %>
  <table class="w-full text-sm">
    <thead>
      <tr class="border-b bg-gray-50">
        <th class="text-left py-2 px-2">タイトル</th>
        <th class="text-left py-2 px-2">チーム</th>
        <th class="text-left py-2 px-2">ステータス</th>
        <th class="text-left py-2 px-2">期限</th>
        <th class="text-left py-2 px-2">担当</th>
        <th class="text-left py-2 px-2"></th>
      </tr>
    </thead>
    <tbody>
      <% @tasks.each do |task| %>
        <tr class="border-b">
          <td class="py-2 px-2">
            <%= link_to task.title, task_path(task), class: "text-blue-600 underline" %>
          </td>
          <td class="py-2 px-2"><%= task.team.name %></td>
          <td class="py-2 px-2"><%= task.status %></td>
          <td class="py-2 px-2">
            <% if task.due_at.present? %>
              <%= l task.due_at, format: :short %>
            <% else %>
              -
            <% end %>
          </td>
          <td class="py-2">
            <% if task.assignees.any? %>
              <% task.assignees.each do |profile| %>
                <span class="inline-flex items-center px-2 py-1 mr-1 mb-1 rounded-full bg-gray-100 text-xs">
                  <%= profile.display_name %>
                </span>
              <% end %>
            <% else %>
              <span class="text-xs text-gray-400">未設定</span>
            <% end %>
          </td>
          <td class="py-2 px-2 text-right">
            <%= link_to "編集", edit_task_path(task),
                        class: "text-xs text-gray-600 underline mr-2" %>
            <%= link_to "削除",
                        task_path(task),
                        data: { turbo_method: :delete, turbo_confirm: "このタスクを削除しますか？" },
                        class: "text-xs text-red-600 underline" %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p class="text-sm text-gray-500">
    まだタスクがありません。「新規タスク作成」から追加してください。
  </p>
<% end %>
