<!-- app/views/devise/registrations/edit.erb -->
<% if user_signed_in? && current_user.profiles.any? %>
  <% content_for :sidebar do %>
    <%= render "profile_settings/sidebar" %>
  <% end %>
<% end %>

<h1 class="text-xl font-bold mb-6">アカウント設定</h1>

<!-- 1) 現在のメール -->
<div class="mb-8 p-4 rounded">
  <h2 class="font-semibold mb-2">現在のメールアドレス</h2>
  <p class="text-sm text-gray-700"><%= current_user.email %></p>

  <% if current_user.respond_to?(:unconfirmed_email) && current_user.unconfirmed_email.present? %>
    <p class="text-xs text-amber-700 mt-2">
      変更申請中： <%= current_user.unconfirmed_email %>（確認待ち）
    </p>
  <% end %>
</div>

<!-- 2) メール変更申請（新しいメールに確認メールを送る） -->
<div class="mb-8 p-4 rounded" id="email">
  <h2 class="font-semibold mb-2">メールアドレスの変更</h2>

  <%= form_with url: send_change_email_path, method: :post, local: true do |f| %>
    <div class="mb-3">
      <%= label_tag :email, "新しいメールアドレス", class: "block text-sm mb-1" %>
      <%= email_field_tag :email, "", class: "w-full border border-gray-300 rounded px-3 py-2" %>
    </div>

    <%= submit_tag "新しいメールアドレスに変更用メールを送信する",
                   class: "px-4 py-2 rounded bg-blue-600 text-white" %>
  <% end %>
</div>

<!-- 3) パスワード変更メール送信（リセットメール） -->
<div class="p-4 rounded" id="password">
  <h2 class="font-semibold mb-2">パスワードの変更</h2>

  <%= button_to "パスワードの変更用メールを送信する",
                send_password_reset_path,
                method: :post,
                class: "px-4 py-2 rounded bg-blue-600 text-white" %>
</div>