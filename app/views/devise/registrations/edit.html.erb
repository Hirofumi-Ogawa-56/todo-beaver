<!-- app/views/devise/registrations/edit.erb -->
<% if user_signed_in? && current_user.profiles.any? %>
  <% content_for :sidebar do %>
    <%= render "profile_settings/sidebar" %>
  <% end %>
<% end %>

<h1 class="text-xl font-bold mb-6"><%= t('devise.registrations.edit.title') %></h1>

<!-- 1) 現在のメール -->
<div class="mb-8 p-4 rounded">
  <h2 class="font-semibold mb-2"><%= t('devise.registrations.edit.current_email') %></h2>
  <p class="text-sm text-gray-700"><%= current_user.email %></p>

  <% if current_user.respond_to?(:unconfirmed_email) && current_user.unconfirmed_email.present? %>
    <p class="text-xs text-amber-700 mt-2">
      <%= t('devise.registrations.edit.unconfirmed_email_msg', email: current_user.unconfirmed_email) %>
    </p>
  <% end %>
</div>

<!-- 2) メール変更申請（新しいメールに確認メールを送る） -->
<div class="mb-8 p-4 rounded" id="email">
  <h2 class="font-semibold mb-2"><%= t('devise.registrations.edit.change_email_title') %></h2>

  <%= form_with url: send_change_email_path, method: :post, local: true do |f| %>
    <div class="mb-3">
      <%= label_tag :email, t('activerecord.attributes.user.new_email'), class: "block text-sm mb-1" %>
      <%= email_field_tag :email, "", class: "w-full border border-gray-300 rounded px-3 py-2" %>
    </div>

    <%= submit_tag t('devise.registrations.edit.send_email_change_instructions'),
                   class: "px-4 py-2 rounded bg-blue-600 text-white" %>
  <% end %>
</div>

<!-- 3) パスワード変更メール送信（リセットメール） -->
<div class="p-4 rounded" id="password">
  <h2 class="font-semibold mb-2"><%= t('devise.registrations.edit.change_password_title') %></h2>

  <%= button_to t('devise.registrations.edit.send_password_reset_instructions'),
                send_password_reset_path,
                method: :post,
                class: "px-4 py-2 rounded bg-blue-600 text-white" %>
</div>