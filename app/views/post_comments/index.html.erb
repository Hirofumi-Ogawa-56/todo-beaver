<!-- app/views/post_comments/index.html.erb -->
<%= turbo_frame_tag "side-panel-frame" do %>
  <div class="flex flex-col h-full bg-white">
    <div class="p-4 border-b bg-gray-50">
      <div class="flex gap-2 items-center mb-1">
        <%= profile_chip(@post.profile, size: :xs) %>
        <span class="font-bold text-xs"><%= @post.profile.display_name %></span>
      </div>
      <div class="text-sm text-gray-700 line-clamp-3"><%= @post.body %></div>
    </div>

    <div class="flex-1 overflow-y-auto p-4 space-y-4">
      <% if @comments.any? %>
        <%= render partial: "post_comments/comment", collection: @comments %>
      <% else %>
        <div class="text-center text-gray-400 text-sm mt-8">まだ返信はありません</div>
      <% end %>
    </div>

    <div class="p-4 border-t">
        <%# URLを post_comments_path(@post) と明示的に指定します %>
            <%= form_with(model: @new_comment, url: post_comments_path(@post), class: "space-y-2") do |f| %>
                <%= f.text_area :body, placeholder: "返信を投稿...", 
                                class: "w-full p-2 border rounded-lg text-sm focus:ring-1 focus:ring-blue-400 outline-none resize-none", rows: 2 %>
                <div class="flex justify-end">
                <%= f.submit "返信", class: "bg-blue-500 text-white px-4 py-1 rounded-full text-sm font-bold cursor-pointer" %>
                </div>
        <% end %>
    </div>
  </div>
<% end %>